<div class="inventory-container">
  <h1 class="inventory-title">Inventory Management</h1>

  <div class="inventory-summary-cards">
    <div class="summary-card">
      <div class="summary-icon blue">üì¶</div>
      <div class="summary-info">
        <h3>Total Products</h3>
        <p>{{ totalProducts }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon red">‚ö†Ô∏è</div>
      <div class="summary-info">
        <h3>Low Stock</h3>
        <p>{{ lowStockCount }}</p>
      </div>
    </div>

  </div>
</div>

<div class="inventory-main-grid">
  <!-- Inventory table -->
  <div class="inventory-card">
    <div class="card-header-row">
      <h2 class="section-title">Inventory Status</h2>

      <div class="search-bar">
        <span class="search-icon">üîç</span>
        <input type="text" placeholder="Search products..." [(ngModel)]="searchQuery" (input)="onSearchChange()" />
      </div>

      <div class="filter-pills">
        <button class="filter-btn" [class.active]="statusFilter === 'All'" (click)="onFilterChange('All')">All</button>
        <button class="filter-btn" [class.active]="statusFilter === 'In Stock'" (click)="onFilterChange('In Stock')">In
          Stock</button>
        <button class="filter-btn" [class.active]="statusFilter === 'Low Stock'"
          (click)="onFilterChange('Low Stock')">Low Stock</button>
      </div>
    </div>

    <div class="table-wrapper">
      <table class="inventory-table">
        <thead>
          <tr>
            <th>Product</th>
            <th>Stock Level</th>
            <th>Reorder Threshold</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of filteredProducts">
            <td>
              <div class="product-cell">
                <div class="product-name">{{ p.name }}</div>
                <div class="product-id">{{ p.productId }}</div>
              </div>
            </td>
            <td>
              <span class="stock-icon">üì¶</span>
              {{ p.stockLevel || 0 }} units
            </td>
            <td>
              {{ p.reorderThreshold || 0 }} units
            </td>
            <td>
              <span [class]="getStatusClass(p)">
                {{ getStatusLabel(p) }}
              </span>
            </td>
            <td>
              <div class="action-buttons-inline">
                <button class="table-btn btn-update" (click)="openStockEditor(p)">Update</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Stock Editor Modal -->
<div class="modal-overlay" *ngIf="editingStockProduct" (click)="closeStockEditor()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h3>Manage Stock - {{ editingStockProduct.name }}</h3>
    <div class="form-row">
      <label>Stock Level</label>
      <input type="number" [(ngModel)]="editStockLevel" min="0" required #stockInput="ngModel" />
      <div *ngIf="stockInput.invalid" class="error-text" style="color: #ef4444; font-size: 12px; margin-top: 4px;">
        Must be 0 or greater.
      </div>
    </div>
    <div class="form-row">
      <label>Reorder Threshold</label>
      <input type="number" [(ngModel)]="editReorderThreshold" min="0" required #threshInput="ngModel" />
      <div *ngIf="threshInput.invalid" class="error-text" style="color: #ef4444; font-size: 12px; margin-top: 4px;">
        Must be 0 or greater.
      </div>
    </div>
    <div class="modal-actions">
      <!-- Manually checking validity since not in a form tag -->
      <button class="primary-btn" (click)="saveStockChanges()"
        [disabled]="editStockLevel === null || editStockLevel < 0 || editReorderThreshold === null || editReorderThreshold < 0">
        Save Stock
      </button>
      <button class="secondary-btn" (click)="closeStockEditor()">Cancel</button>
    </div>
  </div>
</div>